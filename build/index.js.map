{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/*!\n * router\n * Copyright(c) 2015-2017 Fangdun Cai\n * MIT Licensed\n */\n\n'use strict'\n\nimport { parse as parseQueryString, type ParsedUrlQuery } from 'querystring'\n\n// Static Param Any `*` `/` `:`\nconst [SKIND, PKIND, AKIND, STAR, SLASH, COLON] = [0, 1, 2, 42, 47, 58]\n\ntype Result<T = any> = [\n    handler: undefined | T,\n    params: [string, string][],\n    query: ParsedUrlQuery\n]\n\nexport type HTTPMethod =\n    | 'ACL'\n    | 'BIND'\n    | 'CHECKOUT'\n    | 'CONNECT'\n    | 'COPY'\n    | 'DELETE'\n    | 'GET'\n    | 'HEAD'\n    | 'LINK'\n    | 'LOCK'\n    | 'M-SEARCH'\n    | 'MERGE'\n    | 'MKACTIVITY'\n    | 'MKCALENDAR'\n    | 'MKCOL'\n    | 'MOVE'\n    | 'NOTIFY'\n    | 'OPTIONS'\n    | 'PATCH'\n    | 'POST'\n    | 'PROPFIND'\n    | 'PROPPATCH'\n    | 'PURGE'\n    | 'PUT'\n    | 'REBIND'\n    | 'REPORT'\n    | 'SEARCH'\n    | 'SOURCE'\n    | 'SUBSCRIBE'\n    | 'TRACE'\n    | 'UNBIND'\n    | 'UNLINK'\n    | 'UNLOCK'\n    | 'UNSUBSCRIBE'\n\nexport const removeHostnamePath = (path: string) => {\n    if (path.charCodeAt(0) === 47) return path\n\n    const total = path.length\n\n    let i = 1\n    let point = 0\n\n    for (; i < total; i++)\n        if (path.charCodeAt(i) === 47)\n            if (point < 2) point++\n            else break\n\n    return path.slice(i)\n}\n\nconst splitQuery = (s: string) => {\n    const i = s.indexOf('?')\n\n    if (i === -1) return [s, '']\n\n    return [s.slice(0, i), s.slice(i + 1)]\n}\n\nclass TrekNode<T = any> {\n    label: number\n    prefix: string\n    children: any[]\n    kind: number\n    map: Record<\n        string,\n        {\n            handler: T\n            pnames: string\n        }\n    >\n\n    constructor(\n        prefix = '/',\n        children = [] as any[],\n        kind = SKIND,\n        map = Object.create(null)\n    ) {\n        this.label = prefix.charCodeAt(0)\n        this.prefix = prefix\n        this.children = children\n        this.kind = kind\n        this.map = map\n    }\n\n    addChild(n: any) {\n        this.children.push(n)\n    }\n\n    findChild(c: number, t: number, l?: number, e?: TrekNode, i = 0) {\n        for (l = this.children.length; i < l; i++) {\n            e = this.children[i]\n            if (c === e?.label && t === e.kind) {\n                return e\n            }\n        }\n    }\n\n    findChildWithLabel(c: number, l?: number, e?: TrekNode, i = 0) {\n        for (l = this.children.length; i < l; i++) {\n            e = this.children[i]\n            if (c === e?.label) {\n                return e\n            }\n        }\n    }\n\n    findChildByKind(t: number, l?: number, e?: TrekNode, i = 0) {\n        for (l = this.children.length; i < l; i++) {\n            e = this.children[i]\n            if (t === e?.kind) {\n                return e\n            }\n        }\n    }\n\n    addHandler(method: string, handler: T, pnames: string) {\n        this.map[method] = { handler, pnames }\n    }\n\n    findHandler(method: string) {\n        return this.map[method]\n    }\n}\n\nexport default class Router<T = any> {\n    #tree: TrekNode<T>\n    routes: any[]\n\n    constructor() {\n        this.#tree = new TrekNode()\n        this.routes = []\n    }\n\n    add(method: string, path: string, handler: T) {\n        let [i, l, pnames] = [0, path.length, [] as string[]]\n        let ch: number, j: number\n\n        this.routes.push([method, path, handler])\n\n        for (; i < l; ++i) {\n            ch = path.charCodeAt(i)\n            if (ch === COLON) {\n                j = i + 1\n\n                this.#insert(method, path.substring(0, i), SKIND)\n                while (i < l && path.charCodeAt(i) !== SLASH) {\n                    i++\n                }\n\n                pnames.push(path.substring(j, i))\n                path = path.substring(0, j) + path.substring(i)\n                i = j\n                l = path.length\n\n                if (i === l) {\n                    this.#insert(\n                        method,\n                        path.substring(0, i),\n                        PKIND,\n                        pnames,\n                        handler\n                    )\n                    return\n                }\n                this.#insert(method, path.substring(0, i), PKIND, pnames)\n            } else if (ch === STAR) {\n                this.#insert(method, path.substring(0, i), SKIND)\n                pnames.push('*')\n                this.#insert(\n                    method,\n                    path.substring(0, l),\n                    AKIND,\n                    pnames,\n                    handler\n                )\n                return\n            }\n        }\n        this.#insert(method, path, SKIND, pnames, handler)\n    }\n\n    #insert(\n        method: string,\n        path: string,\n        t: number,\n        pnames?: any,\n        handler?: any\n    ) {\n        // Copy current TrekNode as root\n        let [cn] = [this.#tree]\n        let prefix, sl, pl, l, max, n, c\n\n        while (true) {\n            prefix = cn.prefix\n            sl = path.length\n            pl = prefix.length\n            l = 0\n\n            // LCP\n            max = sl < pl ? sl : pl\n            while (l < max && path.charCodeAt(l) === prefix.charCodeAt(l)) {\n                l++\n            }\n\n            /*\n      If (l === 0) {\n        // At root TrekNode\n        cn.label = search.charCodeAt(0)\n        cn.prefix = search\n        if (handler !== undefined) {\n          cn.addHandler(method, { pnames, handler })\n        }\n      } else if (l < pl) {\n      */\n            if (l < pl) {\n                // Split TrekNode\n                n = new TrekNode(\n                    prefix.substring(l),\n                    cn.children,\n                    cn.kind,\n                    cn.map\n                )\n                cn.children = [n] // Add to parent\n\n                // Reset parent TrekNode\n                cn.label = prefix.charCodeAt(0)\n                cn.prefix = prefix.substring(0, l)\n                cn.map = Object.create(null)\n                cn.kind = SKIND\n\n                if (l === sl) {\n                    // At parent TrekNode\n                    cn.addHandler(method, handler, pnames)\n                    cn.kind = t\n                } else {\n                    // Create child TrekNode\n                    n = new TrekNode(path.substring(l), [], t)\n                    n.addHandler(method, handler, pnames)\n                    cn.addChild(n)\n                }\n            } else if (l < sl) {\n                path = path.substring(l)\n                c = cn.findChildWithLabel(path.charCodeAt(0))\n                if (c !== undefined) {\n                    // Go deeper\n                    cn = c\n                    continue\n                }\n                // Create child TrekNode\n                n = new TrekNode(path, [], t)\n                n.addHandler(method, handler, pnames)\n                cn.addChild(n)\n            } else if (handler !== undefined) {\n                // TrekNode already exists\n                cn.addHandler(method, handler, pnames)\n            }\n            return\n        }\n    }\n\n    find(method: HTTPMethod, url: string): Result<T> {\n        const [path, query] = splitQuery(removeHostnamePath(url))\n\n        let result = this.#find(method, path, undefined, 0, [\n            undefined,\n            []\n        ] as any)\n\n        if (query)\n            // @ts-ignore\n            result[2] = parseQueryString(query)\n\n        return result\n    }\n\n    #find(\n        method: HTTPMethod,\n        path: string,\n        cn: TrekNode | undefined,\n        n: number,\n        result: Result<T>\n    ) {\n        cn = cn || this.#tree // Current TrekNode as root\n        const sl = path.length\n        const prefix = cn.prefix\n        const pvalues = result[1] as any[] // Params\n        let i, pl, l, max, c\n        let preSearch // Pre search\n\n        // Search order static > param > match-any\n        if (sl === 0 || path === prefix) {\n            // Found\n            const r = cn.findHandler(method)\n            if ((result[0] = r && r.handler) !== undefined) {\n                const pnames = r.pnames\n                if (pnames !== undefined) {\n                    for (i = 0, l = pnames.length; i < l; ++i) {\n                        pvalues[i] = [pnames[i], pvalues[i]]\n                    }\n                }\n            }\n            return result\n        }\n\n        pl = prefix.length\n        l = 0\n\n        // LCP\n        max = sl < pl ? sl : pl\n        while (l < max && path.charCodeAt(l) === prefix.charCodeAt(l)) l++\n\n        if (l === pl) path = path.substring(l)\n\n        preSearch = path\n\n        // Static TrekNode\n        c = cn.findChild(path.charCodeAt(0), SKIND)\n        if (c !== undefined) {\n            this.#find(method, path, c, n, result)\n            if (result[0] !== undefined) {\n                return result\n            }\n            path = preSearch\n        }\n\n        // Not found TrekNode\n        if (l !== pl) {\n            return result\n        }\n\n        // Param TrekNode\n        c = cn.findChildByKind(PKIND)\n        if (c !== undefined) {\n            l = path.length\n            i = 0\n            while (i < l && path.charCodeAt(i) !== SLASH) {\n                i++\n            }\n\n            pvalues[n] = path.substring(0, i)\n\n            n++\n            preSearch = path\n            path = path.substring(i)\n\n            this.#find(method, path, c, n, result)\n            if (result[0] !== undefined) return result\n\n            n--\n            pvalues.pop()\n            path = preSearch\n        }\n\n        // Any TrekNode\n        c = cn.findChildByKind(AKIND)\n        if (c !== undefined) {\n            pvalues[n] = path\n            path = '' // End search\n            this.#find(method, path, c, n, result)\n        }\n\n        return result\n    }\n}\n"],"names":["Router","removeHostnamePath","SKIND","PKIND","AKIND","STAR","SLASH","COLON","path","charCodeAt","total","length","i","point","slice","splitQuery","s","indexOf","TrekNode","constructor","prefix","children","kind","map","Object","create","label","addChild","n","push","findChild","c","t","l","e","findChildWithLabel","findChildByKind","addHandler","method","handler","pnames","findHandler","tree","routes","add","ch","j","insert","substring","cn","sl","pl","max","undefined","find","url","query","result","parseQueryString","pvalues","preSearch","r","pop"],"mappings":"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"}